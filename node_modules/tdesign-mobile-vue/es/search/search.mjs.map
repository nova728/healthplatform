{"version":3,"file":"search.mjs","sources":["../../src/search/search.tsx"],"sourcesContent":["import { SearchIcon as TSearchIcon, CloseCircleFilledIcon as TIconClear } from 'tdesign-icons-vue-next';\nimport { ref, computed, defineComponent, nextTick } from 'vue';\nimport { useFocus } from '@vueuse/core';\nimport config from '../config';\nimport { preventDefault } from '../shared/dom';\nimport searchProps from './props';\nimport { useDefault } from '../shared/useDefault';\nimport { usePrefixClass } from '../hooks/useClass';\nimport { useTNodeJSX } from '../hooks/tnode';\nimport { TdSearchProps } from './type';\nimport { ENTER_REG } from '../_common/js/common';\n\nconst { prefix } = config;\n\nexport default defineComponent({\n  name: `${prefix}-search`,\n  props: searchProps,\n  setup(props, context) {\n    const renderTNodeJSX = useTNodeJSX();\n    const searchClass = usePrefixClass('search');\n\n    const inputRef = ref<HTMLInputElement>();\n    const { focused } = useFocus(inputRef, { initialValue: props.focus });\n    const [searchValue] = useDefault<TdSearchProps['value'], TdSearchProps>(props, context.emit, 'value', 'change');\n\n    const boxClasses = computed(() => [\n      `${searchClass.value}__input-box`,\n      `${searchClass.value}__input-box--${props.shape}`,\n      {\n        [`${prefix}-is-focused`]: focused.value,\n      },\n    ]);\n\n    const inputClasses = computed(() => [\n      `${prefix}-input__keyword`,\n      { [`${searchClass.value}--center`]: props.center },\n    ]);\n\n    const setInputValue = (v: TdSearchProps['value']) => {\n      const input = inputRef.value;\n      const sV = String(v);\n      if (!input) {\n        return;\n      }\n      if (input.value !== sV) {\n        input.value = sV;\n      }\n    };\n\n    const inputValueChangeHandle = (e: Event) => {\n      const { value } = e.target as HTMLInputElement;\n      searchValue.value = value;\n      nextTick(() => setInputValue(searchValue.value));\n    };\n\n    const handleInput = (e: Event) => {\n      if (e instanceof InputEvent) {\n        // 中文输入的时候inputType是insertCompositionText所以中文输入的时候禁止触发。\n        const checkInputType = e.inputType && e.inputType === 'insertCompositionText';\n        if (e.isComposing || checkInputType) return;\n      }\n\n      inputValueChangeHandle(e);\n    };\n\n    const handleClear = (e: MouseEvent) => {\n      searchValue.value = '';\n      focused.value = true;\n      props.onClear?.({ e });\n    };\n\n    const handleFocus = (e: FocusEvent) => {\n      props.onFocus?.({ value: searchValue.value, e });\n    };\n\n    const handleBlur = (e: FocusEvent) => {\n      props.onBlur?.({ value: searchValue.value, e });\n    };\n\n    const handleCompositionend = (e: CompositionEvent) => {\n      inputValueChangeHandle(e);\n    };\n\n    const handleAction = (e: MouseEvent) => {\n      props.onActionClick?.({ e });\n    };\n\n    const handleSearch = (e: KeyboardEvent) => {\n      // 如果按的是 enter 键, 13是 enter\n      if (ENTER_REG.test(e.code) || ENTER_REG.test(e.key)) {\n        preventDefault(e, false);\n        props.onSubmit?.({ value: searchValue.value, e });\n      }\n    };\n    return () => {\n      const readerLeftIcon = () => {\n        const leftIcon = renderTNodeJSX('leftIcon');\n        if (leftIcon === 'search') {\n          return <TSearchIcon size=\"24px\" />;\n        }\n        return renderTNodeJSX('leftIcon');\n      };\n      const readerClear = () => {\n        if (props.clearable && searchValue.value) {\n          return (\n            <div class={`${searchClass.value}__clear`} onClick={handleClear}>\n              <TIconClear size=\"24\" />\n            </div>\n          );\n        }\n        return null;\n      };\n      const readerAction = () => {\n        const action = renderTNodeJSX('action');\n        if (action && searchValue.value) {\n          return (\n            <div class={`${searchClass.value}__search-action`} onClick={handleAction}>\n              {action}\n            </div>\n          );\n        }\n        return null;\n      };\n\n      return (\n        <div class={`${searchClass.value}`}>\n          <div class={boxClasses.value}>\n            {readerLeftIcon()}\n            <input\n              ref={inputRef}\n              value={searchValue.value}\n              type=\"search\"\n              class={inputClasses.value}\n              autofocus={props.focus}\n              placeholder={props.placeholder}\n              readonly={props.readonly}\n              disabled={props.disabled}\n              onKeypress={handleSearch}\n              onFocus={handleFocus}\n              onBlur={handleBlur}\n              onInput={handleInput}\n              onCompositionend={handleCompositionend}\n            />\n            {readerClear()}\n          </div>\n          {readerAction()}\n        </div>\n      );\n    };\n  },\n});\n"],"names":["prefix","config","defineComponent","name","props","searchProps","setup","context","renderTNodeJSX","useTNodeJSX","searchClass","usePrefixClass","inputRef","ref","_useFocus","useFocus","initialValue","focus","focused","_useDefault","useDefault","emit","_useDefault2","_slicedToArray","searchValue","boxClasses","computed","concat","value","shape","_defineProperty","inputClasses","center","setInputValue","v","input","sV","String","inputValueChangeHandle","e","target","nextTick","handleInput","InputEvent","checkInputType","inputType","isComposing","handleClear","_props$onClear","onClear","call","handleFocus","_props$onFocus","onFocus","handleBlur","_props$onBlur","onBlur","handleCompositionend","handleAction","_props$onActionClick","onActionClick","handleSearch","ENTER_REG","test","code","key","_props$onSubmit","preventDefault","onSubmit","readerLeftIcon","leftIcon","_createVNode","TSearchIcon","readerClear","clearable","TIconClear","readerAction","action","placeholder","readonly","disabled"],"mappings":"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"}