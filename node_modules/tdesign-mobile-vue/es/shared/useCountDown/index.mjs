/**
 * tdesign v1.5.0
 * (c) 2024 TDesign Group
 * @license MIT
 */

import { _ as _asyncToGenerator, r as regenerator } from '../../_chunks/dep-1f2e940b.mjs';
import { ref, reactive } from 'vue';
import { useRafFn } from '@vueuse/core';
import { getShowTimes, getRemainTimes, getScreenFps } from './utils.mjs';
import { isBrowser } from '../util.mjs';
import '../../_chunks/dep-b617aa7d.mjs';
import '../../_chunks/dep-57a75b98.mjs';
import '../../_chunks/dep-4c2819a4.mjs';
import '../../_chunks/dep-4b5beaed.mjs';
import '../../_chunks/dep-5030b0d2.mjs';
import '../../_chunks/dep-c6268b4a.mjs';
import '../../_chunks/dep-06d482c6.mjs';
import '../../config.mjs';

function useCountDown(props) {
  var _ref = props || {},
    _ref$time = _ref.time,
    time = _ref$time === void 0 ? 0 : _ref$time,
    autoStart = _ref.autoStart,
    _ref$millisecond = _ref.millisecond,
    millisecond = _ref$millisecond === void 0 ? false : _ref$millisecond,
    _ref$format = _ref.format,
    format = _ref$format === void 0 ? "HH:mm:ss" : _ref$format,
    _ref$splitWithUnit = _ref.splitWithUnit,
    splitWithUnit = _ref$splitWithUnit === void 0 ? false : _ref$splitWithUnit,
    onFinish = _ref.onFinish,
    onChange = _ref.onChange;
  var fps = ref();
  var count = ref(Number(time));
  var showTimes = reactive(getShowTimes(getRemainTimes(time), format, millisecond, splitWithUnit));
  var _useRafFn = useRafFn(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/regenerator.mark(function _callee() {
      var _getShowTimes, _getShowTimes$forEach;
      var res, times;
      return regenerator.wrap(function _callee$(_context) {
        while (1) switch (_context.prev = _context.next) {
          case 0:
            if (isBrowser) {
              _context.next = 2;
              break;
            }
            return _context.abrupt("return");
          case 2:
            if (fps.value) {
              _context.next = 7;
              break;
            }
            _context.next = 5;
            return getScreenFps === null || getScreenFps === void 0 ? void 0 : getScreenFps();
          case 5:
            res = _context.sent;
            fps.value = res || 60;
          case 7:
            count.value = parseInt("".concat(Number(count.value) - 1e3 / fps.value), 10);
            if (count.value <= 0) {
              pause === null || pause === void 0 || pause();
              count.value = 0;
            }
            times = getRemainTimes(count.value);
            onChange === null || onChange === void 0 || onChange(times);
            count.value === 0 && (onFinish === null || onFinish === void 0 ? void 0 : onFinish());
            (_getShowTimes = getShowTimes(times, format, millisecond, splitWithUnit)) === null || _getShowTimes === void 0 || (_getShowTimes$forEach = _getShowTimes.forEach) === null || _getShowTimes$forEach === void 0 || _getShowTimes$forEach.call(_getShowTimes, function (i, idx) {
              return showTimes[idx].value = i === null || i === void 0 ? void 0 : i.value;
            });
          case 13:
          case "end":
            return _context.stop();
        }
      }, _callee);
    })), {
      immediate: autoStart
    }),
    pause = _useRafFn.pause,
    resume = _useRafFn.resume;
  return {
    time: count,
    showTimes: showTimes,
    pause: pause,
    resume: resume
  };
}

export { useCountDown };
//# sourceMappingURL=index.mjs.map
