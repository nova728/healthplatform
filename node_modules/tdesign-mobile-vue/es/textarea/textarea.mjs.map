{"version":3,"file":"textarea.mjs","sources":["../../src/textarea/textarea.tsx"],"sourcesContent":["import { computed, ref, onMounted, defineComponent, toRefs, nextTick, watch } from 'vue';\nimport { getCharacterLength, useVModel } from '../shared';\nimport config from '../config';\nimport props from './props';\nimport { TextareaValue } from './type';\nimport calcTextareaHeight from '../_common/js/utils/calcTextareaHeight';\nimport { useFormDisabled } from '../form/hooks';\nimport { usePrefixClass } from '../hooks/useClass';\nimport { useTNodeJSX } from '../hooks/tnode';\n\nconst { prefix } = config;\n\nexport default defineComponent({\n  name: `${prefix}-textarea`,\n  props,\n  setup(props, context) {\n    const renderTNodeJSX = useTNodeJSX();\n    const isDisabled = useFormDisabled();\n\n    const textareaClass = usePrefixClass('textarea');\n\n    const textareaClasses = computed(() => [\n      `${textareaClass.value}`,\n      {\n        [`${textareaClass.value}--layout-${props.layout}`]: props.layout,\n        [`${textareaClass.value}--border`]: props.bordered,\n      },\n    ]);\n    const textareaInnerClasses = computed(() => [\n      `${textareaClass.value}__wrapper-inner`,\n      {\n        [`${textareaClass.value}--disabled`]: isDisabled.value,\n        [`${textareaClass.value}--readonly`]: props.readonly,\n      },\n    ]);\n\n    const textareaRef = ref<HTMLTextAreaElement>();\n    const textareaStyle = ref();\n    const { value, modelValue } = toRefs(props);\n    const [innerValue, setInnerValue] = useVModel(value, modelValue, props.defaultValue, props.onChange);\n\n    const setInputValue = (v: TextareaValue = '') => {\n      const input = textareaRef.value;\n      const sV = String(v);\n      if (!input) {\n        return;\n      }\n      if (input.value !== sV) {\n        input.value = sV;\n      }\n    };\n\n    const adjustTextareaHeight = () => {\n      if (props.autosize === true) {\n        textareaStyle.value = calcTextareaHeight(textareaRef.value);\n      } else if (props.autosize === false) {\n        textareaStyle.value = calcTextareaHeight(textareaRef.value, 1, 1);\n      } else if (typeof props.autosize === 'object') {\n        const { minRows, maxRows } = props.autosize;\n        textareaStyle.value = calcTextareaHeight(textareaRef.value, minRows, maxRows);\n      } else if (context.attrs.rows) {\n        textareaStyle.value = { height: 'auto', minHeight: 'auto' };\n      }\n    };\n\n    const handleInput = (e: Event) => {\n      if (e instanceof InputEvent) {\n        if (e.isComposing || e.inputType === 'insertCompositionText') return;\n      }\n      textareaValueChangeHandle();\n    };\n\n    const textareaValueChangeHandle = () => {\n      const textarea = textareaRef.value;\n\n      if (\n        !props.allowInputOverMax &&\n        props.maxcharacter &&\n        props.maxcharacter > 0 &&\n        !Number.isNaN(props.maxcharacter)\n      ) {\n        const { characters = '' } = getCharacterLength(textarea.value, props.maxcharacter) as {\n          length: number;\n          characters: string;\n        };\n        setInnerValue(characters);\n      } else {\n        setInnerValue(textarea.value);\n      }\n      nextTick(() => setInputValue(innerValue.value));\n      adjustTextareaHeight();\n    };\n\n    const textareaLength = computed(() => {\n      const _value = innerValue.value ? String(innerValue.value) : '';\n      if (props.maxcharacter) {\n        return getCharacterLength(_value);\n      }\n      return _value.length;\n    });\n\n    const handleCompositionend = (e: InputEvent | CompositionEvent) => {\n      textareaValueChangeHandle();\n    };\n\n    const handleFocus = (e: FocusEvent) => {\n      props.onFocus?.(innerValue.value, { e });\n    };\n    const handleBlur = (e: FocusEvent) => {\n      props.onBlur?.(innerValue.value, { e });\n    };\n\n    onMounted(() => {\n      if (props.autofocus) {\n        textareaRef.value?.focus();\n      }\n      textareaValueChangeHandle();\n      adjustTextareaHeight();\n    });\n\n    watch(innerValue, () => {\n      nextTick(() => {\n        adjustTextareaHeight();\n      });\n    });\n    watch(\n      () => props.autosize,\n      () => {\n        adjustTextareaHeight();\n      },\n    );\n\n    return () => {\n      const renaderLabel = () => {\n        const label = renderTNodeJSX('label');\n        return label ? <div class={`${textareaClass.value}__label`}>{label}</div> : null;\n      };\n      const readerIndicator = () => {\n        const isShowIndicator = props.indicator && (props.maxcharacter || props.maxlength);\n        if (!isShowIndicator) {\n          return null;\n        }\n        return (\n          <div class={`${textareaClass.value}__indicator`}>\n            {`${textareaLength.value}/${props.maxcharacter || props.maxlength}`}\n          </div>\n        );\n      };\n\n      return (\n        <div class={textareaClasses.value}>\n          {renaderLabel()}\n          <div class={`${textareaClass.value}__wrapper`}>\n            <textarea\n              ref={textareaRef}\n              value={innerValue.value}\n              class={textareaInnerClasses.value}\n              style={textareaStyle.value}\n              name={props.name}\n              maxlength={props.maxlength}\n              disabled={isDisabled.value}\n              placeholder={props.placeholder}\n              readonly={props.readonly}\n              onFocus={handleFocus}\n              onBlur={handleBlur}\n              onInput={handleInput}\n              onCompositionend={handleCompositionend}\n            />\n            {readerIndicator()}\n          </div>\n        </div>\n      );\n    };\n  },\n});\n"],"names":["prefix","config","defineComponent","name","props","setup","context","renderTNodeJSX","useTNodeJSX","isDisabled","useFormDisabled","textareaClass","usePrefixClass","textareaClasses","computed","concat","value","_defineProperty","layout","bordered","textareaInnerClasses","readonly","textareaRef","ref","textareaStyle","_toRefs","toRefs","modelValue","_useVModel","useVModel","defaultValue","onChange","_useVModel2","_slicedToArray","innerValue","setInnerValue","setInputValue","v","arguments","length","undefined","input","sV","String","adjustTextareaHeight","autosize","calcTextareaHeight","_typeof","_props2$autosize","minRows","maxRows","attrs","rows","height","minHeight","handleInput","e","InputEvent","isComposing","inputType","textareaValueChangeHandle","textarea","allowInputOverMax","maxcharacter","Number","isNaN","_getCharacterLength","getCharacterLength","_getCharacterLength$c","characters","nextTick","textareaLength","_value","handleCompositionend","handleFocus","_props2$onFocus","onFocus","handleBlur","_props2$onBlur","onBlur","onMounted","autofocus","_textareaRef$value","focus","watch","renaderLabel","label","_createVNode","readerIndicator","isShowIndicator","indicator","maxlength","placeholder"],"mappings":"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"}