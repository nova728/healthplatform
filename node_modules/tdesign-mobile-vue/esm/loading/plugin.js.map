{"version":3,"file":"plugin.js","sources":["../../src/loading/plugin.tsx"],"sourcesContent":["import { App, Plugin, createApp, defineComponent, h, reactive } from 'vue';\nimport merge from 'lodash/merge';\nimport LoadingComponent from './loading';\nimport { getAttach, removeClass, addClass } from '../shared/dom';\nimport { TdLoadingProps, LoadingInstance, LoadingMethod } from './type';\nimport { usePrefixClass } from '../hooks/useClass';\n\nlet fullScreenLoadingInstance: LoadingInstance = null;\n\nfunction mergeDefaultProps(props: TdLoadingProps): TdLoadingProps {\n  const options: TdLoadingProps = merge(\n    {\n      fullscreen: false,\n      attach: 'body',\n      loading: true,\n    },\n    props,\n  );\n\n  return options;\n}\n\nfunction createLoading(props: TdLoadingProps): LoadingInstance {\n  const mergedProps = mergeDefaultProps(props);\n\n  if (mergedProps.fullscreen && fullScreenLoadingInstance) {\n    return fullScreenLoadingInstance;\n  }\n\n  const component = defineComponent({\n    setup() {\n      const loadingOptions = reactive(mergedProps);\n      return {\n        loadingOptions,\n      };\n    },\n    render() {\n      return h(LoadingComponent, {\n        ...this.loadingOptions,\n      });\n    },\n  });\n\n  const attach = getAttach(mergedProps.fullscreen ? 'body' : mergedProps.attach);\n\n  const app = createApp(component);\n  app.mount(document.createElement('div'));\n  const parentRelativeClass = usePrefixClass('loading__parent--relative').value;\n  const lockClass = usePrefixClass('loading--lock').value;\n\n  if (mergedProps.fullscreen) {\n    addClass(document.body, lockClass);\n  }\n\n  if (attach) {\n    addClass(attach, parentRelativeClass);\n  } else {\n    console.error('attach is not exist');\n  }\n\n  const loadingInstance: LoadingInstance = {\n    hide: () => {\n      removeClass(attach, parentRelativeClass);\n      removeClass(document.body, lockClass);\n      app.unmount();\n    },\n  };\n  return loadingInstance;\n}\n\nfunction produceLoading(props: boolean | TdLoadingProps): LoadingInstance {\n  // 全屏加载\n  if (props === true) {\n    fullScreenLoadingInstance = createLoading({\n      fullscreen: true,\n      loading: true,\n      attach: 'body',\n    });\n    return fullScreenLoadingInstance;\n  }\n\n  if (props === false) {\n    // 销毁全屏实例\n    fullScreenLoadingInstance?.hide();\n    fullScreenLoadingInstance = null;\n    return;\n  }\n  return createLoading(props);\n}\n\nexport type LoadingPluginType = Plugin & LoadingMethod;\n\nexport const LoadingPlugin: LoadingPluginType = produceLoading as LoadingPluginType;\n\nLoadingPlugin.install = (app: App) => {\n  app.config.globalProperties.$loading = produceLoading;\n};\n\nexport default LoadingPlugin;\n"],"names":["fullScreenLoadingInstance","mergeDefaultProps","props","options","merge","fullscreen","attach","loading","createLoading","mergedProps","component","defineComponent","setup","loadingOptions","reactive","render","h","LoadingComponent","_objectSpread","getAttach","app","createApp","mount","document","createElement","parentRelativeClass","usePrefixClass","value","lockClass","addClass","body","console","error","loadingInstance","hide","removeClass","unmount","produceLoading","_fullScreenLoadingIns","LoadingPlugin","install","config","globalProperties","$loading"],"mappings":"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"}